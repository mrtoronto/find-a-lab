{% extends "base.html" %}
{% block app_content %}
<head>
<style>

/* Dropdown Button */
.tableCell {
  padding: 15px
}

</style>

</head>


<!DOCTYPE html>

<html lang="en">

	<head>
		<meta charset="utf-8">
    	<link href="/static/jquery-ui.min.css" rel="stylesheet">
	    <link rel="stylesheet" href="/static/bootstrap.min.css">
    	<link href="/static/tabulator.css" rel="stylesheet">

	</head>
<body data-gr-c-s-loaded="true" style="overflow:scroll">



			<div id="example-table" style="width:150%">
				<table>
				<thead >
		        <tr>
		            <th width="200" frozen="true" class="tableCell">Author Name</th>
		            <th tabulator-hozAlign="left" class="tableCell">N Papers in Query</th>
		            <th tabulator-hozAlign="left" class="tableCell">Locations (# of affiliations, not # papers)</th>
		            <th width="450" tabulator-hozAlign="center"  class="tableCell">papers</th>
		            <th tabulator-hozAlign="center"  class="tableCell">paper keywords</th>
		            <th width="600" tabulator-hozAlign="center" formatter="textarea"  class="tableCell">Affiliations (n) (truncated)</th>

		        </tr>
		    </thead>
		    <tbody>
		    	{% for author, author_dict in json_data.items() %}
		        <tr style="border-top: solid; padding-bottom: 5px">
		            <td class="tableCell">{{ author }}</td>
		            <td sclass="tableCell">{{ author_dict['total_count'] }}</td>
		            <td class="tableCell">
		            {% for loc, count in author_dict['locations'].items() %}
		            <br>{{ loc }} ({{ count }})
		            {% endfor %}
		        	</td>
		            <td class="tableCell">
		            {% for paper in author_dict['papers_links'] %}
		            <br><a href={{ paper["link"] }}>{{ paper['title'] }}</a>
		        	{% endfor %}
		        	</td>
		            <td class="tableCell">
		            {% for keyword, count in author_dict['papers_keywords_counts'][:25] %}
					<br>{{ keyword }} ({{ count }})
					{% endfor %}
		        	</td>
		            <td class="tableCell">
		            {% for affil, count in author_dict['affiliations'].items() %}
		            <div title="{{ affil }}">{{ affil[:50] }} ({{ count }})</div>
		            {% endfor %}
		        	</td>
		        </tr>
		        {% endfor %}
		    </tbody>
		</table>
	</div>
			</div>   
		<div>
	    <button id="download-csv">Download CSV</button>
	    <button id="download-json">Download JSON</button>
		</div>




	<script type="text/javascript" src="/static/tabulator.js"></script>
	<script type="text/javascript" src="/static/jquery-3.5.1.min.js"></script>
	<script type="text/javascript" src="/static/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/static/tabulator_core.js"></script>
	<script type="text/javascript" src="/static/format.js"></script>
	<script type="text/javascript" src="/static/bootstrap.min.js"></script>    
    
    <script type="text/javascript"> 
	// -->
	console.log('{{json_data|safe}}')

	var table = new Tabulator("#example-table", {
							height:"600px",
							layout:"fitDataFill",
    						responsiveLayout:"collapse",
	columns : [
	{formatter:"responsiveCollapse", width:30, minWidth:30, hozAlign:"center", resizable:false, headerSort:false},
    {title:"author", field:"author", width:200, frozen:true, responsive:0},
    {title:"total_count", field:"total_count", hozAlign:"right", sorter:"number", width:150},
    {title:"locations", field:"locations", width:150, responsive:2},
    {title:"affiliations", field:"affiliations", width:150, responsive:2},]})
    
	//trigger download of data.csv file
	document.getElementById("download-csv").addEventListener("click", function(){
	    table.download("csv", "data.csv");
	});

	//trigger download of data.json file
	document.getElementById("download-json").addEventListener("click", function(){
	    table.download("json", "data.json");
	});
	
	</script>  


</body>


</html>


{% endblock %}